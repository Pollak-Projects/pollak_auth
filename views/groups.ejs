<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>Document</title>
</head>
<body>
    <h1 align="center">Csoportok:</h1>
    <div class="d-grid gap-2"><button style="text-align: center;" type="button" class="btn btn-lg btn-outline-primary" data-bs-toggle="modal" data-bs-target="#letrehozas" class="letrehozogomb">
        Új csoport létrehozása
    </button>
    </div>
    <br>
    <div class="d-grid gap-2"><button style="text-align: center;" type="button" class="btn btn-lg btn-outline-danger" data-bs-toggle="modal" data-bs-target="#torles" class="torlogomb">
        Csoport törlése
    </button>
    </div>
    <br>
    <div class="d-grid gap-2"><button style="text-align: center;" type="button" class="btn btn-lg btn-outline-info" data-bs-toggle="modal" data-bs-target="#modositas" class="torlogomb">
        Csoport módosítása
    </button>
    </div>
      
      <!-- Modal -->
        <div class="modal fade" id="letrehozas" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Új csoport létrehozása</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              Csoport neve: <input type="text" name="csoportnev" id="csoportnev">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bezárás</button>
              <button type="button" class="btn btn-primary" onclick="letrehozas()">Létrehozás</button>
            </div>
          </div>
        </div>
        </div>

              <!-- Modal -->
              <div class="modal fade" id="torles" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="exampleModalLabel">Csoport törlése</h1>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      Melyiket szeretnéd törölni?
                      <select name="csopik" id="torlendo">
                        <% groups.forEach(element=> { %>
                            <option value="<%= element.neve %>">
                                <%= element.neve %>
                            </option>
                            <% }); %>
                    </select>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bezárás</button>
                      <button type="button" class="btn btn-primary" onclick="torles()">Törlés</button>
                    </div>
                  </div>
                </div>
                </div>

                              <!-- Modal -->
              <div class="modal fade" id="modositas" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="exampleModalLabel">Csoport módosítása</h1>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      Melyik csoportot szeretnéd módosítani? 
                      <select name="csopik" id="modositando">
                        <% groups.forEach(element=> { %>
                            <option value="<%= element.neve %>">
                                <%= element.neve %>
                            </option>
                            <% }); %>
                    </select>
                    <br><br>
                      Mi legyen az új neve? <input type="text" id="ujnev">
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bezárás</button>
                      <button type="button" class="btn btn-primary" onclick="modositas()">Módosítás</button>
                    </div>
                  </div>
                </div>
                </div>
    <br>
    <br>
    <div class="accordion accordion-flush" id="accordionFlushExample">
                    <% groups.forEach(element => { %>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button style="background-color: rgb(63, 63, 63); color: white;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse<%= element.neve %>" aria-expanded="false" aria-controls="flush-collapse<%= element.neve %>">
                                    <%= element.neve %>
                                </button>            
                            </h2>
                            <div id="flush-collapse<%= element.neve %>" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample" style="background-color: rgb(63, 63, 63)">
                                <div class="accordion-body">
                                    <table class="table table-dark table-hover">
                                        <tr align="center">
                                            <th>id</th>
                                            <th>Nev</th>
                                            <th>Email</th>
                                            <th>OM</th>
                                            <th>Groupsneve</th>
                                            <th></th>

                                        </tr>
                                        <% element.users.forEach(user => { %>
                                            <tr align="center">
                                                <td><%= user.id %></td>
                                                <td><%= user.username %></td>
                                                <td><%= user.email %></td>
                                                <td><%= user.om %></td>
                                                <td><%= user.groupsNeve %></td>
                                                <td><img src="../assets/close.png" class="iksz" onclick="bezar(this)"></td>
                                            </tr>
                                        <% }) %>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <br>
                        
                    <% }) %>
    <script>       
          var field = document.getElementById("csoportnev")
          var field1 = document.getElementById("ujnev")
          
          field.addEventListener('keypress', function( event ) {
            var key = event.keyCode
              if(key === 32){
                event.preventDefault()
              }
          })
          
          field1.addEventListener('keypress', function( event ) {
            var key = event.keyCode
              if(key === 32){
                event.preventDefault()
              }
          }) 

        function bezar(imgElement) {
            // A képet tartalmazó <tr> elemet találjuk meg
            var row = imgElement.closest('tr');
            // Töröljük a sort
            row.remove();

        }
        
        function letrehozas() {
            const csopinev = document.getElementById("csoportnev");

            fetch(`http://localhost:3300/group/add`, {
                headers: {
                    'Content-Type': 'application/json'
                },
                method: "POST",
                body: JSON.stringify({
                    neve: csopinev.value,
                })
            }).then((res) => {
                location.reload()
            })
        }

        function torles() {
            const csopinev = document.getElementById("torlendo");

            fetch(`http://localhost:3300/group/delete`, {
                headers: {
                    'Content-Type': 'application/json'
                },
                method: "DELETE",
                body: JSON.stringify({
                    neve: csopinev.value,
                })
            }).then((res) => {
                location.reload()
            })
        }

        function modositas() {
            const modositandoCsopi = document.getElementById("modositando");
            const csopiUjnev = document.getElementById("ujnev");

            fetch(`http://localhost:3300/group/update`, {
                headers: {
                    'Content-Type': 'application/json'
                },
                method: "PUT",
                body: JSON.stringify({
                    neve: modositandoCsopi.value,
                    ujnev: csopiUjnev.value,
                })
            }).then((res) => {
                location.reload()
            })
        }
    </script>
</body>
</html>
